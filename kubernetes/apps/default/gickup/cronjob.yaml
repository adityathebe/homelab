---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: gickup
  namespace: default
spec:
  schedule: '0 2 * * *' # Run daily at 2 AM
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: gickup
              image: ghcr.io/cooperspencer/gickup:sha-f916b6f
              args: ['/config/conf.yml']
              env:
                - name: GITHUB_TOKEN
                  valueFrom:
                    secretKeyRef:
                      name: gickup-github-token
                      key: token
              volumeMounts:
                - name: config
                  mountPath: /config
                - name: data
                  mountPath: /data
              resources:
                requests:
                  memory: '256Mi'
                  cpu: '100m'
                limits:
                  memory: '1Gi'
                  cpu: '500m'
          volumes:
            - name: config
              configMap:
                name: gickup-config
            - name: data
              persistentVolumeClaim:
                claimName: gickup-storage
          restartPolicy: OnFailure
